<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lassi Shop — Products</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Nosifer&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --accent: #f79013;
        --accent-dark: #e07a0e;
        --pale: #fff;
        --card-bg: #eaa40b;
        --text: #fff;
      }

      * {
        box-sizing: border-box;
        padding: 0;
        margin: 0;
      }

      html,
      body {
        height: 100%;
        background-color: #eff1f3;
        color: var(--text);
        font-family: "Nosifer", sans-serif;
      }

      /* HERO */
      .hero-container {
        background-color: var(--accent);
        width: 100%;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        padding: 1.5rem 1rem;
      }
      .header-text {
        font-family: "Nosifer", sans-serif;
        font-size: 2rem;
        margin-top: 0.5rem;
        text-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
        color: #f5edd9;
      }
      .hero-image {
        width: 100%;
        max-width: 420px;
        border-radius: 12px;
      }

      main {
        padding: 1rem;
        padding-bottom: 80px;
      }

      h2.section-heading {
        text-align: center;
        margin: 1.25rem 0 0.75rem;
        font-size: 1.4rem;
        color: #f79013;
      }

      /* Search */
      .search-container {
        display: flex;
        justify-content: center;
        margin: 0.75rem 0;
      }
      #search-input {
        width: 92%;
        max-width: 520px;
        padding: 10px 12px;
        border-radius: 50px;
        background-color: #eaa40b;
        border: 2px solid rgba(43, 43, 43, 0.08);
        font-size: 1rem;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
      }

      #popular-container {
        /* same visual height as grid rows — tweak if you want taller/shorter */
        height: 340px;
        align-items: stretch; /* make children stretch vertically */
        display: flex; /* already flex but re-declare to be explicit */
        gap: 1rem;
        padding: 1rem;
        overflow-x: auto;
        scrollbar-width: none;
        scroll-snap-type: x mandatory;
      }

      /* ensure each card inside popular fills the container height */
      #popular-container .card {
        min-width: 220px; /* keep the horizontal width */
        height: 100%; /* fill the popular-container height */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      /* keep the same image sizing for popular cards (so images don't overflow) */
      #popular-container .card-img {
        height: 160px; /* matches grid card-img height */
        object-fit: cover;
      }

      /* Grid */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 14px;
        padding: 1rem;
        margin-top: 2.5rem;
        align-items: start; /* grid items align to top; cards fill vertical space via height:100% */
      }
      /* Card */
      .card {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 0.9rem;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* pin bottom row */
        gap: 0.65rem;
        min-width: 180px;
        height: 100%; /* allow grid to control overall height */
        transition: transform 0.12s ease, box-shadow 0.12s ease,
          background-color 0.12s ease;
      }
      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      }

      .card-img {
        width: 100%;
        height: 160px; /* fixed image area — tweak as you like */
        border-radius: 8px;
        object-fit: cover;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.06),
          rgba(0, 0, 0, 0.05)
        );
        flex-shrink: 0;
      }

      /* Title: clamp to 2 lines */
      .card-title {
        font-size: 1.05rem;
        color: var(--pale);
        margin: 0;
        font-weight: 700;
        line-height: 1.1;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      /* make sure price doesn't wrap awkwardly */
      .card-price {
        color: var(--pale);
        margin: 0;
        font-weight: 700;
        white-space: nowrap;
      }

      .like-btn {
        background: transparent;
        border: none;
        color: var(--pale);
        padding: 0.45rem 0.6rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .like-btn.liked {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.28);
      }

      /* icon inside like button */
      .like-icon {
        width: 18px;
        height: 18px;
        display: block;
      }

      /* Meta / description: fixed height & clamp to 3 lines */
      .card-meta {
        font-size: 0.75rem;
        color: rgba(43, 43, 43, 0.85);
        text-align: left;
        margin-top: 0.25rem;
      }

      /* target the paragraph inside card-meta to clamp lines */
      .card-meta p {
        margin: 0;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3; /* show up to 3 lines */
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* bottom row stays at bottom of card */
      .bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
      }

      /* Category */
      .category-container {
        display: flex;
        overflow-x: auto;
        scrollbar-width: none;
        justify-content: start;
        gap: 18px;
        margin: 0.5rem 0 1rem;
      }
      .category-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        width: 96px;
        padding: 6px 4px;
        background: transparent;
        border-radius: 12px;
        cursor: pointer;
        user-select: none;
      }
      .category-circle {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #dff2ec;
        box-sizing: border-box;
        border: 3px solid transparent;
        transition: transform 0.12s ease, border-color 0.12s ease,
          box-shadow 0.12s ease;
      }
      .category-circle img {
        width: 62px;
        height: 62px;
        border-radius: 50%;
        object-fit: cover;
        display: block;
      }
      .category-btn.active .category-circle {
        border-color: var(--accent);
        transform: scale(1.03);
        box-shadow: 0 0 0 6px rgba(247, 144, 19, 0.06);
      }
      .category-label {
        font-family: "Nosifer", sans-serif;
        font-size: 8px;
        text-transform: uppercase;
        color: var(--accent-dark);
        letter-spacing: 2px;
        line-height: 1;
        white-space: nowrap;
        text-align: center;
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 1rem 0;
        flex-wrap: wrap;
      }
      .pagination button {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid rgba(43, 43, 43, 0.12);
        background: white;
        cursor: pointer;
      }
      .pagination button.active {
        background: var(--accent-dark);
        color: white;
        border-color: var(--accent-dark);
      }

      /* Bottom menu */
      .bottom-menu {
        position: fixed;
        bottom: 12px;
        left: 50%;
        transform: translateX(-50%);
        height: 56px;
        min-width: 280px;
        background: linear-gradient(90deg, var(--accent), var(--accent-dark));
        display: flex;
        justify-content: space-around;
        align-items: center;
        color: white;
        font-weight: 700;
        border-radius: 28px;
        z-index: 1000;
        box-shadow: 0 10px 30px rgba(224, 122, 14, 0.25);
      }
      .bottom-menu button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-weight: 700;
        padding: 8px 12px;
        border-radius: 12px;
      }

      /* Drawer */
      .drawer {
        position: fixed;
        right: -100%;
        top: 0;
        width: 360px;
        height: 100%;
        background: #fff;
        box-shadow: -8px 0 26px rgba(0, 0, 0, 0.12);
        transition: right 0.28s ease;
        z-index: 1001;
        padding: 16px;
        overflow-y: auto;
      }
      .drawer.open {
        right: 0;
      }
      .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .drawer-header h3 {
        margin: 0;
        color: var(--text);
      }
      .drawer-close {
        background: var(--accent);
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 8px;
        cursor: pointer;
      }

      /* Liked stacked cards */
      .liked-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 10px 6px;
        overflow: visible;
      }
      .liked-card {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 12px;
        background: var(--card-bg);
        color: var(--pale);
        border-radius: 12px;
        padding: 10px;
        width: 100%;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
      }
      .liked-card img {
        width: 84px;
        height: 84px;
        border-radius: 8px;
        object-fit: cover;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.06),
          rgba(0, 0, 0, 0.03)
        );
        flex-shrink: 0;
      }
      .liked-meta {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 6px;
        flex: 1;
      }
      .liked-name {
        font-family: "Nosifer", sans-serif;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 0;
        color: var(--pale);
      }
      .liked-price {
        font-weight: 800;
        font-size: 14px;
        margin: 0;
        color: var(--pale);
      }
      .liked-unlike {
        background: transparent;
        border: 1px solid rgba(245, 237, 217, 0.18);
        color: var(--pale);
        padding: 6px 8px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 700;
        flex-shrink: 0;
      }

      @media (max-width: 520px) {
        .category-btn {
          width: 70px;
          height: auto;
        }
        .drawer {
          width: 92vw;
        }
        .liked-card img {
          width: 68px;
          height: 68px;
        }
        .like-icon {
          width: 20px;
          height: 20px;
        }
      }
      /* small responsive tweak: reduce image height on narrow screens */
      @media (max-width: 520px) {
        .card-img {
          width: 100%;
          height: auto; /* let image keep its natural height */
          aspect-ratio: unset; /* don't force square */
          object-fit: contain; /* show entire image without cropping */
          background-color: transparent; /* optional: remove background banding */
          border-radius: 8px;
        }
        .card-title {
          -webkit-line-clamp: 2;
        }
        .card-meta p {
          -webkit-line-clamp: 2;
        }
      }
    </style>
  </head>

  <body>
    <div class="hero-container">
      <h2 class="header-text">Lassi Shop</h2>
      <img src="juice2.png" alt="Juice" class="hero-image" />
    </div>

    <main>
      <h2 class="section-heading">Popular Items</h2>
      <div id="popular-container"></div>

      <div class="search-container">
        <input id="search-input" placeholder="Search items..." />
      </div>

      <div class="category-container" id="category-container"></div>

      <div id="all-container" class="grid"></div>

      <div class="pagination" id="pagination"></div>
    </main>

    <!-- Bottom menu -->
    <div class="bottom-menu">
      <button id="home-btn">Home</button>
      <button id="likes-btn">Likes</button>
    </div>

    <!-- Drawer for liked items -->
    <aside class="drawer" id="drawer">
      <div class="drawer-header">
        <h3>Liked Items</h3>
        <button id="close-drawer" class="drawer-close">Close ✖</button>
      </div>
      <div id="liked-container" style="margin-top: 12px"></div>
    </aside>

    <script>
      // ====== ICON PATHS - update if your svgs live elsewhere ======
      const LIKE_ICON = "like.svg";
      const LIKED_ICON = "liked.svg";

      // ====== Data + State ======
      const PRODUCTS_JSON = "data.json";
      const STORAGE_KEY = "lassi-shop-likes-v1";

      let allData = [];
      let filteredData = [];
      let likes = {};
      let currentPage = 1;
      const itemsPerPage = 12;
      let selectedCategory = "";

      const priceFormatter = new Intl.NumberFormat("en-IN", {
        style: "currency",
        currency: "INR",
        maximumFractionDigits: 0,
      });

      // ====== LocalStorage ======
      function loadLikes() {
        try {
          return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        } catch {
          return {};
        }
      }
      function saveLikes() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(likes));
      }
      likes = loadLikes();

      // ====== Fetch Data ======
      async function fetchData() {
        try {
          const res = await fetch(PRODUCTS_JSON);
          allData = await res.json();
        } catch (err) {
          console.error("Failed to load products.json", err);
          allData = [];
          document.getElementById("all-container").innerHTML =
            "<p style='grid-column:1/-1;text-align:center;color:#666'>Unable to load products.</p>";
          return;
        }

        allData = allData.map((p, i) => ({
          id: String(p.id ?? p.sku ?? i),
          name: p.name ?? "Unnamed",
          price: p.price ?? 0,
          image: p.image ?? "juice2.png",
          category: p.category ?? "Uncategorized",
          description: p.description ?? "",
          quantity: p.quantity ?? "",
          popular: !!p.popular,
        }));

        populatePopular();
        populateCategories();
        applyFilters();
      }

      // ====== Render Card (main grid / popular) ======
      function createCard(item) {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.id = item.id;

        const img = document.createElement("img");
        img.className = "card-img";
        img.src = item.image;
        img.alt = item.name;
        img.loading = "lazy";
        card.appendChild(img);

        const title = document.createElement("h3");
        title.className = "card-title";
        title.textContent = item.name;
        card.appendChild(title);

        const meta = document.createElement("div");
        meta.className = "card-meta";
        meta.innerHTML = `<p style="margin:.2rem 0">Serving Time: ${
          item.description ? item.description : "&nbsp;"
        }</p>`;
        card.appendChild(meta);

        const priceEl = document.createElement("p");
        priceEl.className = "card-price";
        priceEl.textContent = priceFormatter.format(item.price);

        const bottom = document.createElement("div");
        bottom.className = "bottom";

        const leftWrap = document.createElement("div");
        leftWrap.appendChild(priceEl);

        const likeBtn = document.createElement("button");
        likeBtn.className = "like-btn";
        likeBtn.dataset.id = item.id;

        // add icon inside button
        const icon = document.createElement("img");
        icon.className = "like-icon";
        icon.alt = likes[item.id] ? "Liked" : "Like";
        icon.src = likes[item.id] ? LIKED_ICON : LIKE_ICON;
        likeBtn.appendChild(icon);

        likeBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          toggleLike(item.id);
        });

        bottom.appendChild(leftWrap);
        bottom.appendChild(likeBtn);
        card.appendChild(bottom);

        return card;
      }

      function populatePopular() {
        const container = document.getElementById("popular-container");
        container.innerHTML = "";

        const popularItems = allData.filter((i) => i.popular);
        if (!popularItems.length) {
          container.innerHTML =
            "<p style='color:#666;padding:.5rem'>No popular items.</p>";
          return;
        }

        popularItems.forEach((item) => {
          const c = createCard(item);
          // ensure it uses the CSS-driven sizing (avoid setting explicit heights here)
          c.style.minWidth = "220px"; // keep card width for horizontal scroller
          c.style.height = ""; // let CSS (#popular-container .card { height: 100% }) control it
          container.appendChild(c);
        });
      }

      // ====== Categories (circle + label) ======
      function populateCategories() {
        const container = document.getElementById("category-container");
        container.innerHTML = "";
        const categories = Array.from(new Set(allData.map((i) => i.category)));
        categories.forEach((cat) => {
          const btn = document.createElement("div");
          btn.className = "category-btn";

          const circle = document.createElement("div");
          circle.className = "category-circle";

          const catImg = document.createElement("img");
          catImg.alt = cat;
          catImg.src = `assets/images/categories/${encodeURIComponent(
            cat
          )}.webp`;
          catImg.onerror = () => {
            const fallback = allData.find((p) => p.category === cat);
            catImg.src = fallback ? fallback.image : "juice2.png";
          };
          circle.appendChild(catImg);

          const label = document.createElement("div");
          label.className = "category-label";
          label.textContent = cat;

          btn.appendChild(circle);
          btn.appendChild(label);

          btn.addEventListener("click", () => {
            selectedCategory = selectedCategory === cat ? "" : cat;
            document
              .querySelectorAll(".category-btn")
              .forEach((b) => b.classList.remove("active"));
            if (selectedCategory) btn.classList.add("active");
            applyFilters();
          });

          container.appendChild(btn);
        });
      }

      // ====== Grid + Pagination ======
      function renderAllItems(data) {
        const container = document.getElementById("all-container");
        container.innerHTML = "";
        const start = (currentPage - 1) * itemsPerPage;
        const pageItems = data.slice(start, start + itemsPerPage);
        if (!pageItems.length) {
          container.innerHTML =
            "<p style='grid-column:1/-1;text-align:center;color:#666'>No items found.</p>";
          renderPagination(0);
          return;
        }
        pageItems.forEach((item) => container.appendChild(createCard(item)));
        renderPagination(data.length);
      }

      function renderPagination(totalItems) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";
        const totalPages = Math.max(1, Math.ceil(totalItems / itemsPerPage));
        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement("button");
          btn.textContent = i;
          if (i === currentPage) btn.classList.add("active");
          btn.addEventListener("click", () => {
            currentPage = i;
            renderAllItems(filteredData.length ? filteredData : allData);
            window.scrollTo({ top: 1130, behavior: "smooth" });
          });
          pagination.appendChild(btn);
        }
      }

      // ====== Filtering / Search ======
      function applyFilters() {
        const searchValue = document
          .getElementById("search-input")
          .value.trim()
          .toLowerCase();
        filteredData = allData.filter((item) => {
          const matchCat = selectedCategory
            ? item.category === selectedCategory
            : true;
          const matchSearch = searchValue
            ? item.name.toLowerCase().includes(searchValue) ||
              (item.description &&
                item.description.toLowerCase().includes(searchValue))
            : true;
          return matchCat && matchSearch;
        });
        currentPage = 1;
        renderAllItems(filteredData.length ? filteredData : allData);
        const d = document.getElementById("drawer");
        if (d.classList.contains("open"))
          renderLikedDrawer({ horizontal: false });
      }
      document
        .getElementById("search-input")
        .addEventListener("input", applyFilters);

      // ====== Likes & Drawer (stacked vertical cards) ======
      function toggleLike(id) {
        if (likes[id]) delete likes[id];
        else likes[id] = true;
        saveLikes();
        updateLikeButtonsUI();
        const d = document.getElementById("drawer");
        if (d.classList.contains("open"))
          renderLikedDrawer({ horizontal: false });
      }

      function updateLikeButtonsUI() {
        // update icon src on all like buttons
        document.querySelectorAll(".like-btn").forEach((btn) => {
          const id = btn.dataset.id;
          if (!id) return;
          const img = btn.querySelector("img.like-icon");
          if (!img) return;
          if (likes[id]) {
            btn.classList.add("liked");
            img.src = LIKED_ICON;
            img.alt = "Liked";
          } else {
            btn.classList.remove("liked");
            img.src = LIKE_ICON;
            img.alt = "Like";
          }
        });
      }

      function renderLikedDrawer({ horizontal = false } = {}) {
        const container = document.getElementById("liked-container");
        container.innerHTML = "";

        const likedIds = Object.keys(likes);
        if (!likedIds.length) {
          container.innerHTML =
            "<p style='color:#666'>You haven't liked any items yet.</p>";
          return;
        }

        const list = document.createElement("div");
        list.className = "liked-list";
        if (!horizontal) list.style.flexDirection = "column";

        const likedItems = allData.filter((i) => likedIds.includes(i.id));
        likedItems.forEach((item) => {
          const card = document.createElement("div");
          card.className = "liked-card";
          card.dataset.id = item.id;

          const img = document.createElement("img");
          img.src = item.image;
          img.alt = item.name;
          img.loading = "lazy";

          const meta = document.createElement("div");
          meta.className = "liked-meta";

          const name = document.createElement("p");
          name.className = "liked-name";
          name.textContent = item.name;

          const price = document.createElement("p");
          price.className = "liked-price";
          try {
            price.textContent = priceFormatter.format(item.price ?? 0);
          } catch {
            price.textContent = item.price ?? "";
          }

          meta.appendChild(name);
          meta.appendChild(price);

          const unlike = document.createElement("button");
          unlike.className = "liked-unlike";
          unlike.textContent = "✖";
          unlike.title = "Remove";
          unlike.addEventListener("click", (e) => {
            e.stopPropagation();
            if (likes[item.id]) delete likes[item.id];
            saveLikes();
            updateLikeButtonsUI();
            renderLikedDrawer({ horizontal: false });
          });

          card.appendChild(img);
          card.appendChild(meta);
          card.appendChild(unlike);

          list.appendChild(card);
        });

        container.appendChild(list);
      }

      // ====== Bottom menu handlers ======
      document.getElementById("likes-btn").addEventListener("click", () => {
        const d = document.getElementById("drawer");
        d.classList.toggle("open");
        if (d.classList.contains("open"))
          renderLikedDrawer({ horizontal: false });
      });
      document.getElementById("close-drawer").addEventListener("click", () => {
        const d = document.getElementById("drawer");
        d.classList.remove("open");
      });
      document.getElementById("home-btn").addEventListener("click", () => {
        selectedCategory = "";
        filteredData = [];
        currentPage = 1;
        document.getElementById("search-input").value = "";
        document
          .querySelectorAll(".category-btn")
          .forEach((b) => b.classList.remove("active"));
        applyFilters();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      // ====== Utils & Startup ======
      function loadLikesStorage() {
        likes = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
      }
      loadLikesStorage();
      fetchData();
    </script>
  </body>
</html>
